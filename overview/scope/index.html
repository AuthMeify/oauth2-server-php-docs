<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Language" content="en-us" />
  <meta http-equiv="imagetoolbar" content="false" />
  <meta name="MSSmartTagsPreventParsing" content="true" />
  <title></title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="changes.atom" />
  <link href="/oauth2-server-php-docs/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/oauth2-server-php-docs/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/oauth2-server-php-docs/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <script src="/oauth2-server-php-docs/shared/js/jquery.js" type="text/javascript"></script>
  <script src="/oauth2-server-php-docs/shared/js/documentation.js" type="text/javascript"></script>
</head>
<body class="api">
    <div id="header-wrapper">
      <div id="header">
        <div>
          <a class="logo" href="/oauth2-server-php-docs/">
            <img src="/oauth2-server-php-docs/images/oauth2-banner.png"/>
          </a>
          <ul class="nav">
            <li><a href="/oauth2-server-php-docs/changes/">Changes</a></li>
            <li><a href="/oauth2-server-php-docs/changes.atom">
              <img src="/oauth2-server-php-docs/images/feed-icon-28x28.png" width="16" height="16" alt="GitHub API Changes Feed" />
            </a></li>
          </ul>
        </div>
      </div><!-- #header -->
    </div><!-- #header-wrapper -->

    <div id="wrapper">
      <div class="content">
    <h2 id="scope">Scope</h2>

<h4 id="configure-your-scope">Configure your Scope</h4>

<p>The use of Scope in an OAuth2 application is often key to proper permissioning. Scope is used to limit the authorization
granted to the client by the resource owner. The most popular use of this is Facebook’s ability for users to authorize
a variety of different functions to the client (“access basic information”, “post on wall”, etc).</p>

<p>In this library, scope is handled by implementing <code>OAuth2\Storage\ScopeInterface</code>. This can be done using your own
implementation, or by taking advantage of the existing <code>OAuth2\Storage\Memory</code> class:</p>

<p>```php
// configure your available scopes
$defaultScope = ‘basic’;
$supportedScopes = array(
  ‘basic’,
  ‘postonwall’,
  ‘accessphonenumber’
);
$memory = new OAuth2\Storage\Memory(array(
  ‘default_scope’ =&gt; $defaultScope,
  ‘supported_scopes’ =&gt; $supportedScopes
));
$scopeUtil = new OAuth2\Scope($memory);</p>

<p>$server-&gt;setScopeUtil($scopeUtil);
```</p>

<p>This is the simplest way, but scope can by dynamically configured as well:</p>

<p>```php
// configure your available scopes
$doctrine = Doctrine_Core::getTable(‘OAuth2Scope’);
$scopeUtil = new OAuth2\Scope($doctrine);</p>

<p>$server-&gt;setScopeUtil($scopeUtil);
```</p>

<p>This example assumes the class being used implements <code>OAuth2\Storage\ScopeInterface</code>:</p>

<p>```php
class OAuth2ScopeTable extends Doctrine_Table implements OAuth2\Storage\ScopeInterface
{
    public function getDefaultScope()
    {
        //…
    }</p>

<pre><code>public function scopeExists($scope, $client_id = null)
{
    //...
} } ```
</code></pre>

<h4 id="validate-your-scope">Validate your scope</h4>

<p>Configuring your scope in the server class will ensure requested scopes by the client are valid.  However, there are two
steps required to ensure the proper validation of your scope.  First, the requested scope must be exposed to the resource
owner upon authorization.  In this library, this is left 100% to the implementation.  The UI or whathaveyou must make clear
the scope of the authorization being granted.  Second, the resource request itself must specify what scope is required to
access it:</p>

<p><code>php
// https://api.example.com/resource-requiring-postonwall-scope
$request = OAuth2\Request::createFromGlobals();
$response = new OAuth2\Response();
$scopeRequired = 'postonwall'; // this resource requires "postonwall" scope
if (!$server-&gt;verifyResourceRequest($request, $response, $scopeRequired)) {
  // if the scope required is different from what the token allows, this will send a "401 insufficient_scope" error
  $response-&gt;send();
}
</code></p>

<h4 id="customizing-your-scope">Customizing your scope</h4>

<p>As the implementation of “scope” can be significantly different for each application, providing a different class other than
OAuth2\Scope can be beneficial.  Implement <code>OAuth2\ScopeInterface</code> in a custom class to fully customize.</p>

<h2 id="state">State</h2>

<p>The <code>state</code> parameter is required by default for authorize redirects.  This is the equivalent of a <code>CSRF</code> token, and provides
session validation for your Authorize request.  See the <a href="http://tools.ietf.org/html/rfc6749#section-4.1.1">OAuth2.0 Spec</a>
for more information on state.</p>

<p>This is enabled by default for security purposes, but you can remove this requirement when you configure your server:</p>

<p>```php
// on creation
$server = new OAuth2\Server($storage, array(‘enforce_state’ =&gt; false));</p>

<p>// or after creation
$server = new OAuth2\Server();
$server-&gt;setConfig(‘enforce_state’, false);
```</p>
      </div>

    <div id="js-sidebar" class="sidebar-shell">
      <div class="js-toggle-list sidebar-module expandable">
        <ul>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php/overview/methods/">Overview</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/overview/methods/">Methods</a></li>
              <li><a href="/oauth2-server-php-docs/overview/grant-types/">Grant Types</a></li>
              <li><a href="/oauth2-server-php-docs/overview/response/">Response</a></li>
              <li><a href="/oauth2-server-php-docs/overview/scope/">Scope</a></li>
              <li><a href="/oauth2-server-php-docs/overview/userid/">User ID</a></li>
            </ul>
          </li>
          <li class="js-topic">
            <h3><a href="#" class="js-expand-btn collapsed">&nbsp;</a><a href="/oauth2-server-php-docs/cookbook/">Cookbook</a></h3>
            <ul class="js-guides">
              <li><a href="/oauth2-server-php-docs/cookbook/">Step-By-Step Walkthrough</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/silex/">Silex</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/doctrine/">Doctrine</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/drupal/">Drupal</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/google-playground/">Google Playground</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/symfony2/">Symfony2</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/doctrine2/">Doctrine2</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/symfony/">Symfony 1.4</a></li>
              <li><a href="/oauth2-server-php-docs/cookbook/laravel/">Laravel</a></li>
            </ul>
          </li>
        </ul>
      </div> <!-- /sidebar-module -->
      <div class="sidebar-module">
        <p>This project is open source. Please help us by forking the project and adding to it.</p>
      </div>
    </div><!-- /sidebar-shell -->

    </div><!-- #wrapper -->

    <div id="footer" >
      <div class="upper_footer">
        <div class="footer_inner clearfix">

        </div><!-- /.site -->
      </div><!-- /.upper_footer -->

      <div class="lower_footer">
        <div class="footer_inner clearfix">
            <div id="legal">
              <p>&copy; <span id="year">year</span> Brent Shaffer. All rights reserved.</p>
            </div><!-- /#legal or /#legal_ie-->
        </div><!-- /.site -->
      </div><!-- /.lower_footer -->
    </div><!-- /#footer -->
</body>
</html>
